<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negev Shelter Access Analysis</title>
    
    <!-- deck.gl (no Mapbox dependency) -->
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl aggregation layers for HeatmapLayer -->
    <script src="https://unpkg.com/@deck.gl/aggregation-layers@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl widgets CSS -->
    <link href="https://unpkg.com/deck.gl@^9.0.0/dist/stylesheet.css" rel='stylesheet' />
    
    <!-- Turf.js for spatial analysis -->
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <!-- Full-screen map -->
        <div id="map"></div>
        
        <!-- Horizontal Brand Banner -->
        <div class="brand-banner">
            <div class="brand-logos">
                <img src="data/Nur-Logo_3x-_1_.svg" alt="Nur Logo" class="logo nur-logo">
                <img src="data/HUJI.svg" alt="Hebrew University of Jerusalem" class="logo huji-logo">
            </div>
            <button class="info-button" id="aboutButton" title="About this project">
                <span>â„¹</span>
            </button>
        </div>
        
        <!-- Statistics & Legend Panel (top-right) - Updated to match main menu style -->
        <div class="stats-legend-panel collapsed">
            <!-- Panel Header with Title (like main menu) -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>ğŸ“Š Stats & Legend</h2>
                    <p>Coverage Analysis</p>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="statsMinimize" title="Minimize">
                        <span>âˆ’</span>
                    </button>
                </div>
            </div>
            
            <!-- Panel Content (like main menu) -->
            <div class="menu-content">
                <!-- Statistics Section -->
                <div class="control-section">
                    <label class="control-label">Coverage Stats</label>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Current</div>
                            <div class="stat-value" id="currentCoverage">--%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">w/ Added</div>
                            <div class="stat-value" id="newCoverage">--%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Buildings</div>
                            <div class="stat-value" id="buildingsCovered">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Additional</div>
                            <div class="stat-value" id="additionalPeople">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- Legend Section -->
                <div class="control-section">
                    <label class="control-label">Map Legend</label>
                    <div class="legend-items" id="legend-items"></div>
                </div>
            </div>
        </div>
        
        <!-- Unified Control Menu (left sidebar) -->
        <div class="main-menu">
            <!-- Menu Header with Title -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>Shelter Access Analysis</h2>
                    <p>Negev Informal Settlements</p>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="menuMinimize" title="Minimize">
                        <span>âˆ’</span>
                    </button>
                </div>
            </div>
            
            <!-- Menu Content -->
            <div class="menu-content">
                <!-- Distance Controls -->
                <div class="control-section">
                    <div class="control-group">
                        <label class="control-label">Coverage Distance</label>
                        <div class="distance-buttons" id="distanceButtons">
                            <button class="distance-button active" data-distance="100">100m</button>
                            <button class="distance-button" data-distance="150">150m</button>
                            <button class="distance-button" data-distance="200">200m</button>
                            <button class="distance-button" data-distance="250">250m</button>
                            <button class="distance-button" data-distance="300">300m</button>
                        </div>
                    </div>
                </div>
                
                <!-- Accessibility Grid Toggle -->
                <div class="control-section">
                    <button id="heatmapToggle" class="accessibility-grid-button">
                        <span class="grid-icon">ğŸƒ</span>
                        <div class="button-content">
                            <span class="button-title" id="heatmapToggleText">Accessibility Grid</span>
                            <span class="button-subtitle">Bomb shelter coverage analysis</span>
                        </div>
                    </button>
                </div>
                
                <!-- New Shelters Control -->
                <div class="control-section">
                    <div class="control-group" id="addedSheltersSection">
                        <label class="control-label">Add Shelters</label>
                        <div class="shelter-control">
                            <input type="range" id="newShelters" class="modern-range" min="0" max="500" value="0" step="1">
                            <div class="control-value" id="newSheltersValue">0</div>
                        </div>
                        <div class="control-description">Improve accessibility to shelter for uncovered residential buildings in informal settlements</div>
                    </div>
                </div>
                
                <!-- Base Map Selection -->
                <div class="control-section">
                    <label class="control-label">Base Map</label>
                    <div class="map-type-selector">
                        <input type="radio" id="satellite" name="basemap" value="satellite" checked>
                        <label for="satellite" class="map-type-option">
                            <span class="map-icon">ğŸ›°ï¸</span>
                            <span>Satellite</span>
                        </label>
                        <input type="radio" id="light" name="basemap" value="light">
                        <label for="light" class="map-type-option">
                            <span class="map-icon">ğŸ—ºï¸</span>
                            <span>Streets</span>
                        </label>
                    </div>
                </div>
                
                <!-- Data & Methods -->
                <div class="control-section">
                    <button id="layersButton" class="action-button">
                        <span>ğŸ—‚ï¸</span>
                        <span>Data Layers</span>
                    </button>
                    <button id="methodsButton" class="action-button secondary">
                        <span>ğŸ“‹</span>
                        <span>Methods</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Custom Scale Bar (positioned under compass) -->
        <div class="scale-bar" id="scaleBar">
            <div class="scale-line" id="scaleLine"></div>
            <div class="scale-text" id="scaleText">100 m</div>
        </div>
        
        <!-- Data Layers Modal -->
        <div id="layersModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Data Layers</h2>
                    <button class="modal-close" id="closeLayersModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="layers-grid">
                        <div class="layer-item">
                            <div class="layer-icon building-icon">
                                <div class="building-square"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="buildingsLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Building Footprints</span>
                                <span class="layer-description">Red outlines â€¢ Hover shows coverage</span>
                                <span class="layer-status" id="buildingLayerStatus">
                                    <span class="status-indicator status-tiles">ğŸ“ Using tiles (zoom 7-13)</span>
                                    <span class="status-indicator status-highlighting" style="display: none;">ğŸ¯ Highlighting available</span>
                                </span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-existing">
                                <img src="data/airtight-hatch-svgrepo-com.svg" width="16" height="16" alt="Existing shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="existingSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Existing Shelters</span>
                                <span class="layer-description">Blue shield icons â€¢ Current sites</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-requested">
                                <img src="data/user-location-icon.svg" width="16" height="16" alt="Requested shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="requestedSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Community Requested</span>
                                <span class="layer-description">Yellow pins â€¢ Resident suggestions</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-optimal">
                                <img src="data/add-location-icon.svg" width="16" height="16" alt="Optimal shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="optimalSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Optimal Shelters</span>
                                <span class="layer-description">Green plus icons â€¢ Algorithm sites</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon polygon-statistical">
                                <div class="polygon-boundary statistical"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statisticalAreasLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Statistical Zones</span>
                                <span class="layer-description">Grey fill with black borders â€¢ Census areas</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon polygon-clusters">
                                <div class="polygon-boundary clusters"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="habitationClustersLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Habitation Clusters</span>
                                <span class="layer-description">Blue boundaries â€¢ Settlement groups</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>About Us</h2>
                    <button class="modal-close" id="closeAboutModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section">
                        <h3>NUR Lab - Negev Urban Research</h3>
                        <p>NUR is a research lab located in Be'er Sheva exploring how new technologies can create smart solutions for the unique problems facing the Negev region and cities throughout Israel.  NUR Lab was launched in 2024 as a collaboration between the MIT Media Lab, Ben Gurion University of the Negev, and SCE Negev School of Architecture. It is part of MIT's global City Science Network â€“ a learning network of 10 collaborative international labs, each solving local challenges that have global implications.</p>

                    </div>
                    
                    <div class="about-section">
                        <h3>Our Partners</h3>
                        <p>This project is developed in collaboration with the <strong>Algorithmic City Planning Lab (ACP)</strong>, at the Hebrew University of Jerusalem which develops quantitative, data-driven tools to support urban planning and public policy. The ACP lab builds high-resolution databases and creates models that help cities make smarter, fairer decisions about resource allocation and urban service design.</p>
                        
                        <p> The dataset on shelter locations for this project was collected by <strong>Bimkom â€“ Planners for Planning Rights</strong>, an Israeli human rights organization formed in 1999 by professional planners and architects to strengthen democracy and human rights in spatial planning and housing policies. Bimkom collects data on informal communities in the Negev with the goal of increasing community participation and advancing more just planning practices that are responsive to community needs.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Methods Modal -->
        <div id="methodsModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Analysis Methods</h2>
                    <button class="modal-close" id="closeMethodsModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section">
                        <h3>Spatial Analysis Methodology</h3>
                        <p>This analysis uses accessibility calculators and spatial clustering to analyze the coverage of existing bomb shelters for informal settlements in the Negev and proposes an algorithmic approach to optimally site new shelters. The methodology combines building footprint data from Microsoft Planetary Computer, GIS layers of informal settlements from the Authority for Development and Settlement of the Bedouin in the Negev (×”×¨×©×•×ª ×œ×¤×™×ª×•×— ×•×”×ª×™×™×©×‘×•×ª ×”×‘×“×•××™× ×‘× ×’×‘), and data collected by Bimkom on shelter locations.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Coverage Analysis</h3>
                        <p>We calculate accessibility using five accessibility radii (100m, 150m, 200m, 250m, 300m) around existing shelters. Each building within the specified radius is considered "covered" by that shelter facility.</p>
                        
                        <p>The accessibility heatmap visualizes coverage quality across the study area - <strong style="color: #14b814;">green areas</strong> indicate well-served locations with good shelter access, while <strong style="color: #c81414;">red areas</strong> highlight underserved neighborhoods that would benefit from additional shelter facilities. For the heatmap, buildings are colored in a binary based on whether they are within the accessibility radius of any existing shelter.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Optimization Algorithm for New Shelter Locations</h3>
                        <p>New shelter locations are determined using an optimizer that aims to maximize the number of houses covered by each additional shelter, while ensuring that there is no overlab with existing shelter coverage. The goal of this algorithm is to encourage resource allocation that prioritizes providing coverage to completely uncovered areas with the largest number of residential buildings. </p>
                        
                        <p><strong>Technical Implementation:</strong> For each of the accessibility distances, the optimization algorithm uses an ensemble of K-means and DBSCAN clustering with 12 different parameters to generate 12 arrays of building clusters. The centroids of these clusters are then used as candidate locations for new shelters. The optimizer then calculates a ranked list of these candidate locations maximizes the number of houses covered by each additional shelter, while ensuring that there is no overlab with existing shelter coverage.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Data Sources & Assumptions</h3>
                        <p><strong>Building Data:</strong> Building footprints were downloaded from Microsoft Planetary Computer and filtered to residential buildings in informal Bedouin settlementsusing multiple parameters: including a GIS layer of informal settlements collected by The Authority for Development and Settlement of the Bedouin in the Negev (×”×¨×©×•×ª ×œ×¤×™×ª×•×— ×•×”×ª×™×™×©×‘×•×ª ×”×‘×“×•××™× ×‘× ×’×‘), census tractss where no legally recognized settlements exist, and building footprint size.
                    
                        <p><strong>Population Estimates:</strong> Based on residential building density with approximately 7 people per residential building, derived consensus of estimates by nonprofits including Bimkom. This rough estimate is used because traditional census data is not available for the informal settlements.</p>
                        
                        <p><strong>Shelter Data:</strong> Existing emergency shelter locations and community-requested sites are collected by Bimkom field workers and community submissions. Therefore, the exact locations of existing shelters may vary slightly from the data used in this analysis. The data on this map should be considered a best estimate of the locations of existing shelters, <strong>NOT</strong> an authoritative resource for emergency situations.</strong></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading overlay -->
        <div id="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>Loading spatial data...</p>
        </div>
        
        <!-- Tooltip -->
        <div id="tooltip" class="tooltip"></div>
        
        <!-- Attribution -->
        <div id="attribution" class="map-attribution"></div>
    </div>
    
    <!-- Application JavaScript -->
    <script src="js/spatial-analysis-simple.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 