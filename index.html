<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negev Shelter Accessibility Analysis</title>
    
    <!-- deck.gl (no Mapbox dependency) -->
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl aggregation layers for HeatmapLayer -->
    <script src="https://unpkg.com/@deck.gl/aggregation-layers@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl widgets CSS -->
    <link href="https://unpkg.com/deck.gl@^9.0.0/dist/stylesheet.css" rel='stylesheet' />
    
    <!-- Turf.js for spatial analysis -->
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <!-- Full-screen map -->
        <div id="map"></div>
        
        <!-- Horizontal Brand Banner -->
        <div class="brand-banner">
            <div class="brand-logos">
                <img src="data/Nur-Logo_3x-_1_.svg" alt="Nur Logo" class="logo nur-logo">
                <img src="data/HUJI.svg" alt="Hebrew University of Jerusalem" class="logo huji-logo">
            </div>
            <button class="about-button" id="aboutButton" title="About Us">
                <span>About Us</span>
            </button>
        </div>
        
        <!-- Statistics Panel (top-right) - Narrative -->
        <div class="stats-panel collapsed">
            <!-- Panel Header -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>Coverage</h2>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="statsMinimize" title="Minimize">
                        <span>âˆ’</span>
                    </button>
                </div>
            </div>
            
            <!-- Panel Content -->
            <div class="menu-content">
                <!-- Statistics Section -->
                <div class="control-section">
                    <div class="stats-narrative">
                        <div class="stat-paragraph">
                            <p id="currentCoverageText">With existing bomb shelters, <strong id="currentCoverage">--%</strong> of residential buildings are currently covered within a <strong id="currentRadius">--m</strong> accessibility distance parameter (maximum residents can travel to reach safety during an emergency alert).</p>
                        </div>
                        <div class="stat-paragraph">
                            <p id="residentsLeftOutText">This leaves approximately <strong id="residentsLeftOut">--</strong> residents without adequate shelter access in the study area.</p>
                        </div>
                        <div class="stat-paragraph">
                            <p id="newCoverageText">By adding <strong id="newSheltersCount">--</strong> strategically placed new shelters, total coverage increases to <strong id="newCoverage">--%</strong> of residential buildings in the study area.</p>
                        </div>
                        <div class="stat-paragraph">
                            <p id="benefitsText">This improvement provides emergency shelter access for <strong id="buildingsCovered">--</strong> additional residential buildings, benefiting an estimated <strong id="additionalPeople">--</strong> additional residents.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Unified Control Menu (left sidebar) -->
        <div class="main-menu">
            <!-- Menu Header with Title -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>Shelter Accessibility Analysis</h2>
                    <p>Negev Informal Settlements</p>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="menuMinimize" title="Minimize">
                        <span>âˆ’</span>
                    </button>
                </div>
            </div>
            
            <!-- Menu Content -->
            <div class="menu-content">
                <!-- Distance Controls -->
                <div class="control-section">
                    <div class="control-group">
                        <label class="control-label">Accessibility Range</label>
                        <div class="distance-buttons" id="distanceButtons">
                            <button class="distance-button active" data-distance="100">100m</button>
                            <button class="distance-button" data-distance="150">150m</button>
                            <button class="distance-button" data-distance="200">200m</button>
                            <button class="distance-button" data-distance="250">250m</button>
                            <button class="distance-button" data-distance="300">300m</button>
                        </div>
                    </div>
                </div>
                
                <!-- Accessibility Grid Toggle - Simplified -->
                <div class="control-section">
                    <div class="control-group">
                        <label class="control-label">
                            <input type="checkbox" id="heatmapToggle" class="checkbox-toggle">
                            <span class="checkbox-label">Show Accessibility Grid</span>
                            <span class="checkbox-checkmark">âœ“</span>
                        </label>
                    </div>
                </div>
                
                <!-- New Shelters Control - Simplified -->
                <div class="control-section">
                    <div class="control-group" id="addedSheltersSection">
                        <div class="shelter-control">
                            <input type="range" id="newShelters" class="modern-range" min="0" max="500" value="0" step="1">
                            <div class="control-value" id="newSheltersValue">0</div>
                        </div>
                        <div class="control-description">Proposed number of new shelters to add</div>
                        <div class="shelter-disabled-tooltip">Turn off Accessibility Grid to add new shelters</div>
                    </div>
                </div>
                
                <!-- Map & Data Controls - Stacked Vertically -->
                <div class="control-section">
                    <div class="control-group">
                        <div class="view-buttons">
                            <button class="view-button active" data-basemap="satellite">Satellite View</button>
                            <button class="view-button" data-basemap="light">Map View</button>
                        </div>
                    </div>
                    <div class="control-group">
                        <button id="layersButton" class="action-button full-width">
                            <span>Data Layers</span>
                        </button>
                    </div>
                </div>
                
                <!-- Legend Section - Moved from right panel -->
                <div class="control-section">
                    <div class="legend-items" id="legend-items"></div>
                </div>
                
                <!-- Info Button - Bottom -->
                <div class="control-section">
                    <button id="methodsButton" class="info-button-bottom">
                        <span>i</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Custom Scale Bar (positioned under compass) -->
        <div class="scale-bar" id="scaleBar">
            <div class="scale-line" id="scaleLine"></div>
            <div class="scale-text" id="scaleText">100 m</div>
        </div>
        
        <!-- Data Layers Modal -->
        <div id="layersModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Data Layers</h2>
                    <button class="modal-close" id="closeLayersModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="layers-grid">
                        <div class="layer-item">
                            <div class="layer-icon building-icon">
                                <div class="building-square"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="buildingsLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Building Footprints</span>
                                <span class="layer-description">Red outlines â€¢ Hover shows coverage</span>
                                <span class="layer-status" id="buildingLayerStatus">
                                    <span class="status-indicator status-tiles">ğŸ“ Using tiles (zoom 7-13)</span>
                                    <span class="status-indicator status-highlighting" style="display: none;">ğŸ¯ Highlighting available</span>
                                </span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-existing">
                                <img src="data/airtight-hatch-svgrepo-com.svg" width="16" height="16" alt="Existing shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="existingSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Existing Shelters</span>
                                <span class="layer-description">Blue shield icons â€¢ Current sites</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-requested">
                                <img src="data/user-location-icon.svg" width="16" height="16" alt="Requested shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="requestedSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Community Requested</span>
                                <span class="layer-description">Yellow pins â€¢ Resident suggestions</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-optimal">
                                <img src="data/add-location-icon.svg" width="16" height="16" alt="Optimal shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="optimalSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Optimal Shelters</span>
                                <span class="layer-description">Green plus icons â€¢ Algorithm sites</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon polygon-statistical">
                                <div class="polygon-boundary statistical"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statisticalAreasLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Statistical Zones</span>
                                <span class="layer-description">Grey fill with black borders â€¢ Census areas</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon polygon-clusters">
                                <div class="polygon-boundary clusters"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="habitationClustersLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Habitation Clusters</span>
                                <span class="layer-description">Blue boundaries â€¢ Settlement groups</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>About Us</h2>
                    <button class="modal-close" id="closeAboutModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section">
                        <h3 style="color: white;">Credits</h3>
                        <p><strong><a href="https://www.linkedin.com/in/noam-gal/" target="_blank">Noam Gal</a></strong> (NUR) - Project Lead, Data Scientistâ€” coded the application, designed the algorithms, and created the visualizations (NUR)</p>
                        
                        <p><strong><a href="https://www.linkedin.com/in/mdrogochinsky/" target="_blank">Michael Drogochinsky </a></strong> (ACP) -  Geospatial Expert, Data Analyst â€” Analyzed geospatial layers, including ETL operations, exploratory data analysis, and data cleaning </p>
                        
                        <p><strong><a href="https://www.linkedin.com/in/ar-nikitin/" target="_blank">Artem Nikitin</a></strong> (ACP) â€” Visual Designer, Architect â€” Designed the user interface layout and visual laanguage in Figma (ACP)</p>
                        
                        <p><strong><a href="https://www.instagram.com/lobnaalsana/?hl=en" target="_blank">Lobna Alsana</a></strong> (Bimkom) - Outreach Coordinator, Architect â€” Led data collection on shelter locations and managed community outreach </p>
                        
                        <p><strong><a href="https://www.linkedin.com/in/merav-battat-305b0a249/" target="_blank">Merav Battat</a></strong> (Director of NUR), <strong><a href="https://www.linkedin.com/in/yonatan-cohen-a3b6325/" target="_blank">Yonatan Cohen</a></strong> (Director of Technologies at NUR), and <strong><a href="https://www.linkedin.com/in/taliakaufmann/" target="_blank">Dr. Talia Kaufmann</a></strong> ( Head of ACP) - Provided project guidance, resources, and feedback</p>
                    </div>
                    
                    <div class="about-section">
                        <h3 style="color: white;">Organizations</h3>
                        <p><strong><a href="https://www.nurlab.org/" target="_blank">NUR Lab - Negev Urban Research</a></strong> is a research lab located in Be'er Sheva exploring how new technologies can create smart solutions for the unique problems facing the Negev region and cities throughout Israel.</p>
                        
                        <p>This project is developed in collaboration with the <strong><a href="https://he-urbaninnovation.huji.ac.il/%D7%9E%D7%A2%D7%91%D7%93%D7%95%D7%AA/algorithmic-city-planning-lab" target="_blank">Algorithmic City Planning Lab (ACP)</a></strong>, at the Hebrew University of Jerusalem and <strong><a href="https://bimkom.org/eng/home-mobile/" target="_blank">Bimkom â€“ Planners for Planning Rights</a></strong>.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Methods Modal -->
        <div id="methodsModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Analysis Methods</h2>
                    <button class="modal-close" id="closeMethodsModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section">
                        <h3>Spatial Analysis Methodology</h3>
                        <p>This analysis uses accessibility calculators and spatial clustering to analyze the coverage of existing bomb shelters for informal settlements in the Negev and proposes an algorithmic approach to optimally site new shelters. The methodology combines building footprint data from Microsoft Planetary Computer, GIS layers of informal settlements from the Authority for Development and Settlement of the Bedouin in the Negev (×”×¨×©×•×ª ×œ×¤×™×ª×•×— ×•×”×ª×™×™×©×‘×•×ª ×”×‘×“×•××™× ×‘× ×’×‘), and data collected by Bimkom on shelter locations.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Coverage Analysis</h3>
                        <p>We calculate accessibility using five accessibility radii (100m, 150m, 200m, 250m, 300m) around existing shelters. Each building within the specified radius is considered "covered" by that shelter facility.</p>
                        
                        <p>The accessibility heatmap visualizes coverage quality across the study area - <strong style="color: #14b814;">green areas</strong> indicate well-served locations with good shelter access, while <strong style="color: #c81414;">red areas</strong> highlight underserved neighborhoods that would benefit from additional shelter facilities. For the heatmap, buildings are colored in a binary based on whether they are within the accessibility radius of any existing shelter.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Optimization Algorithm for New Shelter Locations</h3>
                        <p>New shelter locations are determined using an optimizer that aims to maximize the number of houses covered by each additional shelter, while ensuring that there is no overlab with existing shelter coverage. The goal of this algorithm is to encourage resource allocation that prioritizes providing coverage to completely uncovered areas with the largest number of residential buildings. </p>
                        
                        <p><strong>Technical Implementation:</strong> For each of the accessibility distances, the optimization algorithm uses an ensemble of K-means and DBSCAN clustering with 12 different parameters to generate 12 arrays of building clusters. The centroids of these clusters are then used as candidate locations for new shelters. The optimizer then calculates a ranked list of these candidate locations maximizes the number of houses covered by each additional shelter, while ensuring that there is no overlab with existing shelter coverage.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Data Sources & Assumptions</h3>
                        <p><strong>Building Data:</strong> Building footprints were downloaded from Microsoft Planetary Computer and filtered to residential buildings in informal Bedouin settlementsusing multiple parameters: including a GIS layer of informal settlements collected by The Authority for Development and Settlement of the Bedouin in the Negev (×”×¨×©×•×ª ×œ×¤×™×ª×•×— ×•×”×ª×™×™×©×‘×•×ª ×”×‘×“×•××™× ×‘× ×’×‘), census tractss where no legally recognized settlements exist, and building footprint size.
                    
                        <p><strong>Population Estimates:</strong> Based on residential building density with approximately 7 people per residential building, derived consensus of estimates by nonprofits including Bimkom. This rough estimate is used because traditional census data is not available for the informal settlements.</p>
                        
                        <p><strong>Shelter Data:</strong> Existing emergency shelter locations and community-requested sites are collected by Bimkom field workers and community submissions. Therefore, the exact locations of existing shelters may vary slightly from the data used in this analysis. The data on this map should be considered a best estimate of the locations of existing shelters, <strong>NOT</strong> an authoritative resource for emergency situations.</strong></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading overlay -->
        <div id="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>Loading spatial data...</p>
        </div>
        
        <!-- Tooltip -->
        <div id="tooltip" class="tooltip"></div>
        
        <!-- Attribution -->
        <div id="attribution" class="map-attribution"></div>
    </div>
    
    <!-- Application JavaScript -->
    <script src="js/spatial-analysis-simple.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 