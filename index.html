<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negev Shelter Accessibility Analysis</title>
    
    <!-- deck.gl (no Mapbox dependency) -->
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl aggregation layers for HeatmapLayer -->
    <script src="https://unpkg.com/@deck.gl/aggregation-layers@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl widgets CSS -->
    <link href="https://unpkg.com/deck.gl@^9.0.0/dist/stylesheet.css" rel='stylesheet' />
    
    <!-- Turf.js for spatial analysis -->
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <!-- Full-screen map -->
        <div id="map"></div>
        
        <!-- Horizontal Brand Banner -->
        <div class="brand-banner">
            <div class="brand-logos">
                <img src="data/Nur-Logo_3x-_1_.svg" alt="Nur Logo" class="logo nur-logo">
                <img src="data/HUJI.svg" alt="Hebrew University of Jerusalem" class="logo huji-logo">
            </div>
        </div>
        
        <!-- Statistics Panel (top-right) - Narrative -->
        <div class="stats-panel collapsed">
            <!-- Panel Header -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>Coverage</h2>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="statsMinimize" title="Minimize">
                        <span>‚àí</span>
                    </button>
                </div>
            </div>
            
            <!-- Panel Content -->
            <div class="menu-content">
                <!-- Statistics Section -->
                <div class="control-section">
                    <div class="stats-narrative">
                        <div class="stat-paragraph">
                            <p id="currentCoverageText">With existing bomb shelters, <strong id="currentCoverage">--%</strong> of residential buildings are currently covered within a <strong id="currentRadius">--m</strong> accessibility distance parameter (maximum residents can travel to reach safety during an alert).</p>
                        </div>
                        <div class="stat-paragraph">
                            <p id="residentsLeftOutText">This leaves approximately <strong id="residentsLeftOut">--</strong> residents without adequate shelter access in the study area.</p>
                        </div>
                        <div class="stat-paragraph">
                            <p id="newCoverageText">By adding <strong id="newSheltersCount">--</strong> strategically placed new shelters, total coverage increases to <strong id="newCoverage">--%</strong> of residential buildings in the study area.</p>
                        </div>
                        <div class="stat-paragraph">
                            <p id="benefitsText">This improvement provides bomb shelter access for <strong id="buildingsCovered">--</strong> additional residential buildings, benefiting an estimated <strong id="additionalPeople">--</strong> additional residents.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Unified Control Menu (left sidebar) -->
        <div class="main-menu">
            <!-- Menu Header with Title -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>Shelter Accessibility Analysis</h2>
                    <p>Negev Informal Settlements</p>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="menuMinimize" title="Minimize">
                        <span>‚àí</span>
                    </button>
                </div>
            </div>
            
            <!-- Menu Content -->
            <div class="menu-content">
                <!-- Distance Controls -->
                <div class="control-section">
                    <div class="control-group">
                        <label class="control-label">Accessibility Range</label>
                        <div class="distance-buttons" id="distanceButtons">
                            <button class="distance-button active" data-distance="100">100m</button>
                            <button class="distance-button" data-distance="150">150m</button>
                            <button class="distance-button" data-distance="200">200m</button>
                            <button class="distance-button" data-distance="250">250m</button>
                            <button class="distance-button" data-distance="300">300m</button>
                        </div>
                    </div>
                </div>
                
                <!-- Accessibility Grid Toggle - Simplified -->
                <div class="control-section">
                    <div class="control-group">
                        <label class="control-label">
                            <input type="checkbox" id="heatmapToggle" class="checkbox-toggle">
                            <span class="checkbox-label">Show Accessibility Grid</span>
                            <span class="checkbox-checkmark">‚úì</span>
                        </label>
                    </div>
                </div>
                
                <!-- New Shelters Control - Simplified -->
                <div class="control-section">
                    <div class="control-group" id="addedSheltersSection">
                        <div class="shelter-control">
                            <input type="range" id="newShelters" class="modern-range" min="0" max="500" value="0" step="1">
                            <div class="control-value" id="newSheltersValue">0</div>
                        </div>
                        <div class="control-description">Proposed number of new shelters to add</div>
                        <div class="shelter-disabled-tooltip">Turn off Accessibility Grid to add new shelters</div>
                    </div>
                </div>
                
                <!-- Map & Data Controls - Stacked Vertically -->
                <div class="control-section">
                    <div class="control-group">
                        <div class="view-buttons">
                            <button class="view-button active" data-basemap="satellite">Satellite View</button>
                            <button class="view-button" data-basemap="light">Map View</button>
                        </div>
                    </div>
                    <div class="control-group">
                        <button id="layersButton" class="action-button full-width">
                            <span>Data Layers</span>
                        </button>
                    </div>
                </div>
                
                <!-- Legend Section - Moved from right panel -->
                <div class="control-section">
                    <div class="legend-items" id="legend-items"></div>
                </div>
                
                <!-- About & Info Buttons - Bottom -->
                <div class="control-section">
                    <div class="bottom-buttons">
                        <button class="bottom-button about-button" id="aboutButton" title="About Us">
                            <span>About Us</span>
                        </button>
                        <button class="bottom-button info-button" id="methodsButton" title="Analysis Methods">
                            <span>i</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Custom Scale Bar (positioned under compass) -->
        <div class="scale-bar" id="scaleBar">
            <div class="scale-line" id="scaleLine"></div>
            <div class="scale-text" id="scaleText">100 m</div>
        </div>
        
        <!-- Data Layers Modal -->
        <div id="layersModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Data Layers</h2>
                    <button class="modal-close" id="closeLayersModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="layers-grid">
                        <div class="layer-item">
                            <div class="layer-icon building-icon">
                                <div class="building-square"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="buildingsLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Building Footprints</span>
                                <span class="layer-description">Red outlines ‚Ä¢ Hover shows coverage</span>
                                <span class="layer-status" id="buildingLayerStatus">
                                    <span class="status-indicator status-tiles">üìê Using tiles (zoom 7-13)</span>
                                    <span class="status-indicator status-highlighting" style="display: none;">üéØ Highlighting available</span>
                                </span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-existing">
                                <img src="data/airtight-hatch-svgrepo-com.svg" width="16" height="16" alt="Existing shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="existingSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Existing Shelters</span>
                                <span class="layer-description">Blue shield icons ‚Ä¢ Current sites</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-requested">
                                <img src="data/user-location-icon.svg" width="16" height="16" alt="Requested shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="requestedSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Community Requested</span>
                                <span class="layer-description">Yellow pins ‚Ä¢ Resident suggestions</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon shelter-optimal">
                                <img src="data/add-location-icon.svg" width="16" height="16" alt="Optimal shelter icon">
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="optimalSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Optimal Shelters</span>
                                <span class="layer-description">Green plus icons ‚Ä¢ Algorithm sites</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon polygon-statistical">
                                <div class="polygon-boundary statistical"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statisticalAreasLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Statistical Zones</span>
                                <span class="layer-description">Grey fill with black borders ‚Ä¢ Census areas</span>
                            </div>
                        </div>
                        <div class="layer-item">
                            <div class="layer-icon polygon-clusters">
                                <div class="polygon-boundary clusters"></div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="habitationClustersLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <div class="layer-info">
                                <span class="layer-label">Habitation Clusters</span>
                                <span class="layer-description">Blue boundaries ‚Ä¢ Settlement groups</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>About Us</h2>
                    <button class="modal-close" id="closeAboutModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section">
                        <h3 style="color: white;">Credits</h3>
                        <p><strong><a href="https://www.linkedin.com/in/noam-gal/" target="_blank">Noam Gal</a></strong> (NUR) - Project Lead, Data Scientist</p>
                        
                        <p><strong><a href="https://www.instagram.com/lobnaalsana/?hl=en" target="_blank">Lobna Alsana</a></strong> (Bimkom) - Outreach Coordinator </p>
                        
                        <p><strong><a href="https://www.linkedin.com/in/mdrogochinsky/" target="_blank">Michael Drogochinsky </a></strong> (ACP) -  Geospatial Data Analyst </p>
                        
                        <p><strong><a href="https://www.linkedin.com/in/ar-nikitin/" target="_blank">Artem Nikitin</a></strong> (ACP) ‚Äî Visual Design </p>
                        
                        <p> <strong><a href="https://www.linkedin.com/in/taliakaufmann/" target="_blank">Dr. Talia Kaufmann</a></strong> (Head of ACP), <strong><a href="https://www.linkedin.com/in/merav-battat-305b0a249/" target="_blank">Merav Battat</a></strong> (Director of NUR), and <strong><a href="https://www.linkedin.com/in/yonatan-cohen-a3b6325/" target="_blank">Yonatan Cohen</a></strong> (Director of Technologies NUR) - Project guidance, resources, and feedback</p>
                    </div>
                    
                    <div class="about-section">
                        <h3 style="color: white;">Collaborators</h3>
                        
                        <p>This project is developed in collaboration by <strong><a href="https://www.nurlab.org/" target="_blank">NUR Lab - Negev Urban Research</a></strong>, <strong><a href="https://he-urbaninnovation.huji.ac.il/%D7%9E%D7%A2%D7%91%D7%93%D7%95%D7%AA/algorithmic-city-planning-lab" target="_blank">Algorithmic City Planning Lab (ACP)</a></strong>, and <strong><a href="https://bimkom.org/eng/home-mobile/" target="_blank">Bimkom ‚Äì Planners for Planning Rights</a></strong>.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Methods Modal -->
        <div id="methodsModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>How to Use This Tool</h2>
                    <button class="modal-close" id="closeMethodsModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section guide-section">
                        <h3>Getting Started</h3>
                        
                        <div class="guide-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <span class="step-title">Set Accessibility Distance</span>
                                <p class="step-description">Use accessibility range buttons (100m-300m) to set how far residents can travel to reach a bomb shelter during an emergency.</p>
                            </div>
                        </div>
                        
                        <div class="guide-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <span class="step-title">View Current Coverage</span>
                                <p class="step-description">See current coverage by turning on Accessibility Grid.</p>
                            </div>
                        </div>
                        
                        <div class="guide-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <span class="step-title">Add New Shelters</span>
                                <p class="step-description">Use slider to add strategically placed new shelters.</p>
                            </div>
                        </div>
                        
                        <div class="guide-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <span class="step-title">Click Coverage</span>
                                <p class="step-description">Click on coverage window to review accessiblity statistics.</p>
                            </div>
                        </div>
                        
                        <div class="guide-step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <span class="step-title">Explore Data</span>
                                <p class="step-description">Click "Data Layers" to show new information like community requests for shelters and change display layers.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="about-section">
                        <h3>What This Analysis Shows</h3>
                        <p>This tool analyzes bomb shelter accessibility for informal Bedouin settlements in the Negev region and suggests optimal locations for new shelters to expand coverage.</p>
                        
                        <p>The <strong style="color: #14b814;">green areas</strong> in the accessibility grid indicate neighborhoods with good shelter access with existing conditions, while <strong style="color: #c81414;">red areas</strong> highlight underserved communities that would benefit from additional shelter facilities.</p>
                        
                        <p>New shelters are added using an optimizer that aims to maximize the number of residential houses covered by each additional shelter, while ensuring that there is no overlap with existing shelter coverage.
                        </p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Technical Details</h3>
                        <p><strong>New Shelters Location Optimizer:</strong>  The optimization algorithm uses an ensemble of unsupervised learning methods, specificallyK-means and DBSCAN clustering with 12 different parameters to generate 12 arrays of building clusters. The centroids of these clusters are then used as candidate locations for new shelters. The optimizer then calculates a ranked list of these candidate locations maximizes the number of houses covered by each additional shelter, while ensuring that there is no overlab with existing shelter coverage.</p>
                        <p><strong>Building Data:</strong> Building footprints were downloaded from Microsoft Planetary Computer and filtered to residential buildings in informal Bedouin settlements using multiple parameters: including a GIS layer of informal settlements collected by The Authority for Development and Settlement of the Bedouin in the Negev (◊î◊®◊©◊ï◊™ ◊ú◊§◊ô◊™◊ï◊ó ◊ï◊î◊™◊ô◊ô◊©◊ë◊ï◊™ ◊î◊ë◊ì◊ï◊ê◊ô◊ù ◊ë◊†◊í◊ë), census tracts from the Central Bureau of Statistics (◊ú◊û◊≥◊≥◊°)  where no legally recognized settlements exist, and building footprint size.</p>
                        <p><strong>Population Estimates:</strong> Based on a consensus of estimates by NGOs, including Bimkom, for residential building density of approximately 7 people per residential building. This estimate is used because traditional census data is not available for informal settlements.</p>
                        <p><strong>Shelter Data:</strong> Existing emergency shelter locations and community-requested sites are collected by Bimkom field workers and community submissions. Reach Bimkom for more information on shelter locations.</p>
                        <p><strong>Critical Note:</strong> The data on this map should be considered a best estimate of the locations of existing shelters, <strong>NOT</strong> an authoritative resource for emergency situations.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading overlay -->
        <div id="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>Loading spatial data...</p>
        </div>
        
        <!-- Tooltip --
        <div id="tooltip" class="tooltip"></div>
        
        <!-- Attribution -->
        <div id="attribution" class="map-attribution"></div>
    </div>
    
    <!-- Application JavaScript -->
    <script src="js/spatial-analysis-simple.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 