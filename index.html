<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negev Shelter Access Analysis</title>
    
    <!-- deck.gl (no Mapbox dependency) -->
    <script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl aggregation layers for HeatmapLayer -->
    <script src="https://unpkg.com/@deck.gl/aggregation-layers@^9.0.0/dist.min.js"></script>
    
    <!-- deck.gl widgets CSS -->
    <link href="https://unpkg.com/deck.gl@^9.0.0/dist/stylesheet.css" rel='stylesheet' />
    
    <!-- Turf.js for spatial analysis -->
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app">
        <!-- Full-screen map -->
        <div id="map"></div>
        
        <!-- Horizontal Brand Banner -->
        <div class="brand-banner">
            <div class="brand-logos">
                <img src="data/Nur-Logo_3x-_1_.svg" alt="Nur Logo" class="logo nur-logo">
                <img src="data/HUJI.svg" alt="Hebrew University of Jerusalem" class="logo huji-logo">
            </div>
            <button class="info-button" id="aboutButton" title="About this project">
                <span>‚Ñπ</span>
            </button>
        </div>
        
        <!-- Statistics & Legend Panel (top-right) - Updated to match main menu style -->
        <div class="stats-legend-panel collapsed">
            <!-- Panel Header with Title (like main menu) -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>üìä Stats & Legend</h2>
                    <p>Coverage Analysis</p>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="statsMinimize" title="Minimize">
                        <span>‚àí</span>
                    </button>
                </div>
            </div>
            
            <!-- Panel Content (like main menu) -->
            <div class="menu-content">
                <!-- Statistics Section -->
                <div class="control-section">
                    <label class="control-label">Coverage Stats</label>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Current</div>
                            <div class="stat-value" id="currentCoverage">--%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">w/ Added</div>
                            <div class="stat-value" id="newCoverage">--%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Buildings</div>
                            <div class="stat-value" id="buildingsCovered">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Additional</div>
                            <div class="stat-value" id="additionalPeople">--</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Suboptimal</div>
                            <div class="stat-value" id="suboptimalRequested">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Potential</div>
                            <div class="stat-value" id="underservedPeople">0</div>
                        </div>
                    </div>
                </div>
                
                <!-- Legend Section -->
                <div class="control-section">
                    <label class="control-label">Map Legend</label>
                    <div class="legend-items" id="legend-items"></div>
                </div>
            </div>
        </div>
        
        <!-- Unified Control Menu (left sidebar) -->
        <div class="main-menu">
            <!-- Menu Header with Title -->
            <div class="menu-header">
                <div class="menu-title">
                    <h2>Shelter Access Analysis</h2>
                    <p>Negev Informal Settlements</p>
                </div>
                <div class="menu-actions">
                    <button class="menu-button minimize" id="menuMinimize" title="Minimize">
                        <span>‚àí</span>
                    </button>
                </div>
            </div>
            
            <!-- Menu Content -->
            <div class="menu-content">
                <!-- Analysis Controls -->
                <div class="control-section">
                    <div class="control-group">
                        <label class="control-label">Distance</label>
                        <input type="range" id="accessibilityDistance" class="modern-range" min="100" max="300" step="50" value="100">
                        <div class="control-value" id="accessibilityDistanceValue">100m</div>
                    </div>
                    
                    <div class="control-group" id="addedSheltersSection">
                        <label class="control-label">New Shelters</label>
                        <input type="range" id="newShelters" class="modern-range" min="0" max="500" value="10" step="1">
                        <div class="control-value" id="newSheltersValue">10</div>
                    </div>
                </div>
                
                <!-- Map Type Selection -->
                <div class="control-section">
                    <label class="control-label">Map Type</label>
                    <div class="map-type-selector">
                        <input type="radio" id="satellite" name="basemap" value="satellite" checked>
                        <label for="satellite" class="map-type-option">
                            <span class="map-icon">üõ∞Ô∏è</span>
                            <span>Satellite</span>
                        </label>
                        <input type="radio" id="light" name="basemap" value="light">
                        <label for="light" class="map-type-option">
                            <span class="map-icon">üó∫Ô∏è</span>
                            <span>Streets</span>
                        </label>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="control-section">
                    <button id="heatmapToggle" class="action-button">
                        <span>üî•</span>
                        <span id="heatmapToggleText">Heatmap</span>
                    </button>
                    <button id="layersButton" class="action-button">
                        <span>üóÇÔ∏è</span>
                        <span>Data Layers</span>
                    </button>
                    <button id="methodsButton" class="action-button secondary">
                        <span>üìã</span>
                        <span>Methods</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Custom Scale Bar (positioned under compass) -->
        <div class="scale-bar" id="scaleBar">
            <div class="scale-line" id="scaleLine"></div>
            <div class="scale-text" id="scaleText">100 m</div>
        </div>
        
        <!-- Data Layers Modal -->
        <div id="layersModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Data Layers</h2>
                    <button class="modal-close" id="closeLayersModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="layers-grid">
                        <div class="layer-item">
                            <label class="toggle-switch">
                                <input type="checkbox" id="buildingsLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="layer-label">Building Footprints</span>
                        </div>
                        <div class="layer-item">
                            <label class="toggle-switch">
                                <input type="checkbox" id="existingSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="layer-label">Existing Shelters</span>
                        </div>
                        <div class="layer-item">
                            <label class="toggle-switch">
                                <input type="checkbox" id="requestedSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="layer-label">Community Requested</span>
                        </div>
                        <div class="layer-item">
                            <label class="toggle-switch">
                                <input type="checkbox" id="optimalSheltersLayer" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="layer-label">Optimal Shelters</span>
                        </div>
                        <div class="layer-item">
                            <label class="toggle-switch">
                                <input type="checkbox" id="statisticalAreasLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="layer-label">Statistical Zones</span>
                        </div>
                        <div class="layer-item">
                            <label class="toggle-switch">
                                <input type="checkbox" id="habitationClustersLayer">
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="layer-label">Habitation Clusters</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>About This Project</h2>
                    <button class="modal-close" id="closeAboutModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section">
                        <h3>NUR Lab - Negev Urban Research</h3>
                        <p>Located in Be'er Sheva and serving cities throughout Israel, the NUR lab is a creative workspace for visiting researchers and project-specific teams to meet and tackle specific questions and opportunities together. NUR Lab fosters the exchange of innovative methods and creative approaches through conferences, workshops and public discussions. Life here, on the edge of the desert is rapidly changing ‚Äì hot, dense, multicultural and deprived of essential resources ‚Äì a reality in many cities, and a potential future for countless others.</p>
                        
                        <p>NUR was launched in 2024 as a collaboration between the MIT Media Lab, Ben Gurion University of the Negev, and SCE Negev School of Architecture. It is part of MIT's global City Science Network ‚Äì a learning network of 10 collaborative international labs, each solving local challenges that have global implications.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Our Partners</h3>
                        <p>This project is developed in collaboration with the <strong>Algorithmic City Planning Lab</strong>, which develops quantitative, data-driven tools to support urban planning and public policy. Working with local authorities, the lab builds high-resolution databases and creates models that help cities make smarter, fairer decisions about resource allocation and urban service design.</p>
                        
                        <p><strong>Bimkom ‚Äì Planners for Planning Rights</strong> is an Israeli human rights organization formed in 1999 by professional planners and architects to strengthen democracy and human rights in spatial planning and housing policies. Drawing on values of social justice and community participation, Bimkom advances more just planning practices that are responsive to local community needs.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Methods Modal -->
        <div id="methodsModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Analysis Methods</h2>
                    <button class="modal-close" id="closeMethodsModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="about-section">
                        <h3>Spatial Analysis Methodology</h3>
                        <p>This analysis uses spatial optimization algorithms to evaluate shelter accessibility across Jerusalem. The methodology combines building footprint data, population estimates, and existing shelter locations to identify gaps in emergency shelter coverage and propose optimal locations for new facilities.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Coverage Analysis</h3>
                        <p>We calculate accessibility using walking distance buffers (100m-200m) around existing shelters, accounting for building density and estimated population. Each building within the specified radius is considered "covered" by that shelter facility.</p>
                        
                        <p>The accessibility heatmap visualizes coverage quality across the study area - <strong style="color: #14b814;">green areas</strong> indicate well-served locations with good shelter access, while <strong style="color: #c81414;">red areas</strong> highlight underserved neighborhoods that would benefit from additional shelter facilities.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Optimization Algorithm</h3>
                        <p>New shelter locations are determined using a facility location optimization that maximizes population coverage while minimizing overlap with existing facilities. The algorithm prioritizes locations that serve the highest number of previously uncovered residents.</p>
                        
                        <p>The optimization considers both spatial efficiency (serving dense areas) and equity (ensuring coverage reaches underserved communities). Sites are ranked by their potential impact on overall accessibility.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Data Sources & Assumptions</h3>
                        <p><strong>Building Data:</strong> Municipal GIS databases provide building footprints and classifications used to identify residential structures and estimate shelter demand.</p>
                        
                        <p><strong>Population Estimates:</strong> Based on residential building density with approximately 7 people per residential building, derived from census and municipal planning data.</p>
                        
                        <p><strong>Shelter Data:</strong> Existing emergency shelter locations and community-requested sites from municipal emergency management databases.</p>
                        
                        <p><strong>Technical Implementation:</strong> Analysis performed using spatial clustering, network analysis, and facility location optimization techniques implemented in Python with PostGIS spatial database backend.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading overlay -->
        <div id="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <p>Loading spatial data...</p>
        </div>
        
        <!-- Tooltip -->
        <div id="tooltip" class="tooltip"></div>
        
        <!-- Attribution -->
        <div id="attribution" class="map-attribution"></div>
    </div>
    
    <!-- Application JavaScript -->
    <script src="js/spatial-analysis-simple.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 